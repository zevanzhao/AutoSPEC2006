# 简介
SPEC CPU 是最权威、最全面的处理器性能基准测试程序之一。SPEC CPU 2006是其中一个仍然被广泛采用的版本。  
在使用SPEC CPU 进行处理器性能基准测试的时候，选择合适的编译选项有助于充分发挥处理器的性能，得到更高的分数。  
然而，现代编译器有数以百计的优化选项。从中找出最合适的优化选项组合，几乎是不可能的。靠手工配置参数来得到最佳优化选项组合，也是一个非常冗长乏味又耗时的事情。  
为了解决这个问题，我写了一个脚本，能够自动进行SPEC CPU 2006测试，并找出一个比较好的测试选项组合。  

# 程序的原理
程序运行的原理非常简单直接。给出若干可能有用的编译选项，依次加入到SPEC CPU 2006的优化选项中，进行测试。如果测试结果变好了，就保留优化选项；如果测试结果变差了，就抛弃这个优化选项。不断重复以上的测试，直到用掉所有候选的优化选项。  
由于编译器优化选项之间实际上是会互相影响的，因此上述方法并不严谨。不过，实际使用中程序确实能够给出一个不错的优化选项的组合。  

# 使用方法
## 安装SPEC CPU 2006
首先，完成SPEC CPU 2006的安装。如果不熟悉SPEC CPU 2006的安装，可以参考 guee 的作品《在龙芯3A5000上测试SPEC CPU 2006》https://zhuanlan.zhihu.com/p/393600027   
## 准备输入文件
AutoSPEC2006需要三个输入文件：一个文件提供SPEC CPU config文件的模版，一个控制AutoSPEC程序的运行，一个提供候选的GCC 优化选项。这个三个文件均可以从example文件夹中找到例子。  
SPEC CPU configure文件模版为bench.cfg和bench_ia32.cfg，请根据实际测试的情况，选择合适的文件进行修改。注意，AutoSPEC程序运行的时候依赖特定的config文件的结构，因此最好不要使用用户自己的config文件。  
控制AutoSPEC脚本的文件为SPEC.conf。比较关键的是benchmarks，用于设置AutoSPEC运行时优化的测试项目。如果其中有多个项目，程序运行的时候会依次优化。  
GCC 优化选项列表保存在文件gcc.json中，提供了40多个优化选项。用户需要根据处理器的架构、编译器的版本等对文件进行修改。

## 运行程序

在SPEC 2006目录中，运行source shrc，设置好环境变量。  
将SPEC.conf，gcc.json文件放在SPEC 2006的目录中，将修改好的bench.cfg文件放在config文件夹中。  
运行
> AutoSPEC.py SPEC.conf
即可。

## 程序输出
日志文件会记录到AutoSPEC.log中，同时还会生成jobs.json文件，记录程序运行中使用的优化选项，以及对应的测试成绩。
